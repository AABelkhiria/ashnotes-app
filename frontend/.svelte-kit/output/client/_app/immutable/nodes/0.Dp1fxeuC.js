import"../chunks/CWj6FrbW.js";import{i as ee}from"../chunks/BM7KANXt.js";import{B as fe,C as ye,aI as we,p as te,aT as De,m as O,k as D,q as o,g as n,v as s,a7 as C,n as g,a as ae,w as _,l as Y,f as G,d as F,t as J,x as K,X as re,aS as se,s as k,aU as de,o as pe}from"../chunks/D_uOQWZ4.js";import{d as Ee,e as oe,i as ne,b as ie,I as le,s as he,t as Z,r as ke,f as Te,c as Ne}from"../chunks/D7ZDF7IB.js";import{p as I,i as U,s as ge,a as _e}from"../chunks/CxqE7Zb0.js";function $e(h,c,r,y,E){var u;fe&&ye();var i=(u=c.$$slots)==null?void 0:u[r],w=!1;i===!0&&(i=c.children,w=!0),i===void 0||i(h,w?()=>y:y)}function Ae(h,c,r,y){var E=h.__style;if(fe||E!==c){var i=Ee(c);(!fe||i!==h.getAttribute("style"))&&(i==null?h.removeAttribute("style"):h.style.cssText=i),h.__style=c}return y}function me(h){return function(...c){var r=c[0];return r.stopPropagation(),h==null?void 0:h.apply(this,c)}}const ve=we("light");function ue(){ve.update(h=>{const c=h==="light"?"dark":"light";return localStorage.setItem("theme",c),c})}var xe=D("<li> </li>"),Pe=D("<p>This will also delete the following subdirectories:</p> <ul></ul>",1),qe=D('<h2>Confirm Deletion</h2> <p> </p> <!> <div class="modal-actions svelte-10is9fs"><button>Confirm</button> <button>Cancel</button></div>',1),Me=D("<li><!> </li>"),Se=D('<h2>Deleting...</h2> <ul></ul> <div class="modal-actions svelte-10is9fs"><button>Close</button></div>',1),Ce=D('<div class="modal-overlay svelte-10is9fs" role="dialog" aria-modal="true" tabindex="-1"><div class="modal-content svelte-10is9fs"><!></div></div>');function Re(h,c){te(c,!1);let r=I(c,"directoryName",8),y=I(c,"filesToDelete",8),E=I(c,"subDirPaths",8);const i=De();let w=O(!1),u=O(y().map(e=>({path:e,status:"pending"})));async function A(){k(w,!0),await new Promise(e=>setTimeout(e,0));for(let e=0;e<y().length;e++){const f=y()[e];de(u,n(u)[e].status="deleting"),k(u,[...n(u)]),await new Promise(v=>setTimeout(v,50));try{const v=await fetch(`${ie}/api/notes/${f}`,{method:"DELETE"});if(!v.ok)throw new Error(`HTTP ${v.status}`);de(u,n(u)[e].status="deleted")}catch(v){de(u,n(u)[e].status="failed"),console.error(`Failed to delete ${f}:`,v)}k(u,[...n(u)])}}function T(){i("close")}function P(e){if(e.endsWith("README.md")){const f=e.substring(0,e.length-10);return f===""?"./":f}return e}ee();var q=Ce(),H=o(q),M=o(H);{var j=e=>{var f=qe(),v=_(Y(f),2),N=o(v);s(v);var t=_(v,2);{var m=x=>{var R=Pe(),p=_(Y(R),2);oe(p,5,E,ne,(b,L)=>{var S=xe(),X=o(S,!0);s(S),J(()=>K(X,n(L))),g(b,S)}),s(p),g(x,R)};U(t,x=>{G(E()),F(()=>E().length>0)&&x(m)})}var d=_(t,2),a=o(d),$=_(a,2);s(d),J(()=>K(N,`Are you sure you want to delete the directory "${r()??""}" and all its contents?`)),C("click",a,A),C("click",$,T),g(e,f)},l=e=>{var f=Se(),v=_(Y(f),2);oe(v,5,()=>n(u),ne,(m,d)=>{var a=Me(),$=o(a);{var x=b=>{var L=se("✅");g(b,L)},R=(b,L)=>{{var S=B=>{var z=se("⏳");g(B,z)},X=(B,z)=>{{var ce=W=>{var V=se("❌");g(W,V)},Q=W=>{var V=se("⚪");g(W,V)};U(B,W=>{n(d),F(()=>n(d).status==="failed")?W(ce):W(Q,!1)},z)}};U(b,B=>{n(d),F(()=>n(d).status==="deleting")?B(S):B(X,!1)},L)}};U($,b=>{n(d),F(()=>n(d).status==="deleted")?b(x):b(R,!1)})}var p=_($);s(a),J(b=>K(p,` ${b??""}`),[()=>(n(d),F(()=>P(n(d).path)))],re),g(m,a)}),s(v);var N=_(v,2),t=o(N);s(N),C("click",t,T),g(e,f)};U(M,e=>{n(w)?e(l,!1):e(j)})}s(H),s(q),C("keydown",q,e=>{e.key==="Enter"&&T()}),g(h,q),ae()}var Fe=D('<li class="svelte-pd1qg1"><!></li>'),Ue=D('<details class="note-item-details svelte-pd1qg1" open><summary class="svelte-pd1qg1"><div class="summary-content svelte-pd1qg1"><div class="name-container svelte-pd1qg1"><a class="note-item-link svelte-pd1qg1"> </a></div> <div class="actions-icons svelte-pd1qg1"><button class="icon-button svelte-pd1qg1" title="New Note"><!></button> <button class="icon-button svelte-pd1qg1" title="Delete Directory"><!></button></div></div></summary> <ul class="svelte-pd1qg1"></ul></details>'),He=D('<a class="note-item-link svelte-pd1qg1"> </a>'),Le=D('<!> <div class="note-item-container svelte-pd1qg1"><!></div>',1);function be(h,c){te(c,!1);let r=I(c,"item",8),y=I(c,"level",8),E=O(!1);function i(t){return t.startsWith("notes/")?t.substring(6):t}const w=r().type==="dir"&&Array.isArray(r().children)?r().children.find(t=>t.name==="README.md"):void 0,u=Array.isArray(r().children)?r().children.filter(t=>t.name!=="README.md"):[];async function A(){const t=prompt("Enter the name for the new note:","new-note");if(!t)return;const m=`${i(r().path)}/${t}/README.md`,d=`# ${t}`;try{const a=await fetch(`${ie}/api/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:m,content:d})});if(!a.ok){if(a.status===500){Z();return}throw a.status===409?new Error(`A note with the name "${t}" already exists in this directory.`):new Error(`HTTP error! status: ${a.status}`)}Z()}catch(a){console.error("Failed to create note:",a),alert(`Failed to create note: ${a.message}`)}}let T=O([]),P=O([]);async function q(){function t(d){const a=[],$=[];function x(p,b){if(p.type==="dir"){const L=b?`${b}/${p.name}`:p.name;p!==d&&$.push(L);const S=`${i(p.path)}/README.md`;if(a.includes(S)||a.push(S),p.children&&p.children.length>0)for(const X of p.children)x(X,L)}else a.push(i(p.path))}x(d,"");const R=[...new Set(a)];return R.sort((p,b)=>(b.match(/\//g)||[]).length-(p.match(/\//g)||[]).length),{filesToDelete:R,subDirPaths:$}}const m=t(r());k(T,m.filesToDelete),k(P,m.subDirPaths),k(E,!0)}function H(){k(E,!1),Z()}ee();var M=Le(),j=Y(M);{var l=t=>{Re(t,{get directoryName(){return G(r()),F(()=>r().name)},get filesToDelete(){return n(T)},get subDirPaths(){return n(P)},$$events:{close:H}})};U(j,t=>{n(E)&&t(l)})}var e=_(j,2),f=o(e);{var v=t=>{var m=Ue(),d=o(m),a=o(d),$=o(a),x=o($),R=o(x,!0);s(x),s($);var p=_($,2),b=o(p),L=o(b);le(L,{name:"plus"}),s(b);var S=_(b,2),X=o(S);le(X,{name:"trash"}),s(S),s(p),s(a),s(d);var B=_(d,2);oe(B,5,()=>u,ne,(z,ce)=>{var Q=Fe(),W=o(Q);const V=re(()=>y()+1);be(W,{get item(){return n(ce)},get level(){return n(V)}}),s(Q),g(z,Q)}),s(B),s(m),J(z=>{he(x,"href",`/notes/${z??""}`),K(R,(G(r()),F(()=>r().name)))},[()=>(G(r()),F(()=>i(w?w.path:r().path+"/README.md")))],re),C("click",b,me(A)),C("click",S,me(q)),g(t,m)},N=t=>{var m=He(),d=o(m,!0);s(m),J(a=>{he(m,"href",`/notes/${a??""}`),K(d,(G(r()),F(()=>r().name)))},[()=>(G(r()),F(()=>i(r().path)))],re),g(t,m)};U(f,t=>{G(r()),F(()=>r().type==="dir")?t(v):t(N,!1)})}s(e),J(()=>Ae(e,`padding-left: ${y()*.125}rem;`)),g(h,M),ae()}var Oe=D('<p class="svelte-va6g4v">Loading...</p>'),je=D('<p class="error svelte-va6g4v"> </p>'),Be=D('<p class="svelte-va6g4v">No notes found. Create your first note!</p>'),Je=D('<li class="svelte-va6g4v"><!></li>'),We=D('<ul class="svelte-va6g4v"></ul>'),Xe=D('<div class="note-tree svelte-va6g4v"><div class="note-tree-header svelte-va6g4v"><h2 class="svelte-va6g4v"><a href="/notes/README.md" class="svelte-va6g4v">Notes</a></h2> <button class="icon-button" title="New Root Note"><!></button></div> <!></div>');function ze(h,c){te(c,!1);let r=O([]),y=O(null),E=O(!0);async function i(){const l=prompt("Enter the name for the new root note:","new-root-note");if(!l)return;const e=`${l}/README.md`,f=`# ${l}`;try{const v=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,content:f})});if(!v.ok){if(v.status===500){Z();return}throw v.status===409?new Error(`A note with the name "${l}" already exists at the root.`):new Error(`HTTP error! status: ${v.status}`)}Z()}catch(v){console.error("Failed to create root note:",v),alert(`Failed to create root note: ${v.message}`)}}function w(l){return Array.isArray(l)?l.map(e=>{const f=Array.isArray(e.children);return{...e,path:e.id,type:f?"dir":"file",children:f?w(e.children):null}}).filter(e=>e.name!=="README.md"):[]}async function u(){k(E,!0),k(y,null);try{const l=await fetch("/api/notes");if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const e=await l.json();k(r,w(e))}catch(l){k(y,`Failed to fetch or process notes: ${l.message}`),console.error(n(y))}finally{k(E,!1)}}pe(()=>(u(),ke.subscribe(()=>{u()}))),ee();var A=Xe(),T=o(A),P=_(o(T),2),q=o(P);le(q,{name:"plus"}),s(P),s(T);var H=_(T,2);{var M=l=>{var e=Oe();g(l,e)},j=(l,e)=>{{var f=N=>{var t=je(),m=o(t,!0);s(t),J(()=>K(m,n(y))),g(N,t)},v=(N,t)=>{{var m=a=>{var $=Be();g(a,$)},d=a=>{var $=We();oe($,5,()=>n(r),ne,(x,R)=>{var p=Je(),b=o(p);be(b,{get item(){return n(R)},level:0}),s(p),g(x,p)}),s($),g(a,$)};U(N,a=>{n(r).length===0?a(m):a(d,!1)},t)}};U(l,N=>{n(y)?N(f):N(v,!1)},e)}};U(H,l=>{n(E)?l(M):l(j,!1)})}s(A),C("click",P,i),g(h,A),ae()}var Ge=D('<div class="modal-overlay svelte-1r6ao13" role="button" tabindex="0"></div> <div class="modal svelte-1r6ao13"><h2>Settings</h2> <div class="setting svelte-1r6ao13"><label for="backendUrl" class="svelte-1r6ao13">Backend URL</label> <input type="text" id="backendUrl" class="svelte-1r6ao13"/></div> <div class="setting svelte-1r6ao13"><label for="darkMode" class="svelte-1r6ao13">Dark Mode</label> <button> </button></div> <button>Save</button></div>',1),Ke=D('<div class="settings-container svelte-1r6ao13"><button class="icon-button"><!></button> <!></div>');function Qe(h,c){te(c,!1);const[r,y]=ge(),E=()=>_e(ve,"$theme",r);let i=O(!1),w=O("");ie.subscribe(M=>{k(w,M)});function u(){ie.set(n(w)),k(i,!1)}ee();var A=Ke(),T=o(A),P=o(T);le(P,{name:"settings"}),s(T);var q=_(T,2);{var H=M=>{var j=Ge(),l=Y(j),e=_(l,2),f=_(o(e),2),v=_(o(f),2);Te(v),s(f);var N=_(f,2),t=_(o(N),2),m=o(t,!0);s(t),s(N);var d=_(N,2);s(e),J(()=>K(m,`Switch to ${E()==="dark"?"Light":"Dark"} Mode`)),C("click",l,()=>k(i,!1)),C("keydown",l,a=>a.key==="Escape"&&k(i,!1)),Ne(v,()=>n(w),a=>k(w,a)),C("click",t,function(...a){ue==null||ue.apply(this,a)}),C("click",d,u),g(M,j)};U(q,M=>{n(i)&&M(H)})}s(A),C("click",T,()=>k(i,!n(i))),g(h,A),ae(),y()}var Ve=D('<div class="app-container svelte-1dhmdvo"><aside class="sidebar svelte-1dhmdvo"><!> <div class="settings-container svelte-1dhmdvo"><!></div></aside> <main class="content svelte-1dhmdvo"><!></main></div>');function at(h,c){te(c,!1);const[r,y]=ge(),E=()=>_e(ve,"$theme",r);pe(()=>{const H=localStorage.getItem("theme")||"light";ve.set(H)}),ee();var i=Ve(),w=o(i),u=o(w);ze(u,{});var A=_(u,2),T=o(A);Qe(T,{}),s(A),s(w);var P=_(w,2),q=o(P);$e(q,c,"default",{}),s(P),s(i),J(()=>he(i,"data-theme",E())),g(h,i),ae(),y()}export{at as component};
