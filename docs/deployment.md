# Continuous Deployment

This project uses GitHub Actions workflows to automate the release and deployment process. When a commit is pushed to the `main` branch, the following workflows are triggered:

### 1. Create Release (`.github/workflows/release.yml`)

This workflow is responsible for building the desktop application, versioning, and creating a new GitHub Release.

-   **Trigger**: Pushes to the `main` branch.
-   **Steps**:
    1.  **Checkout Code**: Fetches the repository code.
    2.  **Setup Node.js & Rust**: Configures the environment with necessary tools for frontend and backend builds.
    3.  **Install Frontend Dependencies**: Installs Node.js packages required for the SvelteKit frontend.
    4.  **Get Latest Tag**: Retrieves the most recent Git tag to determine the current version.
    5.  **Calculate New Version**: Determines the new version number based on the current date and the latest tag. The versioning scheme is `YY.MM.minor`, where `YY` is the year, `MM` is the month, and `minor` is an incremental number that resets to `1` each month for a new month.
    6.  **Update Version in `tauri.conf.json`**: Injects the newly calculated version into the Tauri configuration file.
    7.  **Build Application**: Compiles the desktop application, generating a `.deb` package for Linux.
    8.  **Find Debian Package**: Locates the generated `.deb` file.
    9.  **Create Release and Upload Asset**: Creates a new GitHub Release with the new version tag and uploads the `.deb` package as a release asset.
    10. **Upload .deb as an Artifact**: Uploads the `.deb` package as a workflow artifact for later use.

### 2. Publish to APT Repository (`.github/workflows/publish_apt_repo.yml`)

This workflow is triggered after a successful release and publishes the generated `.deb` package to a Debian APT repository hosted via GitHub Pages.

-   **Trigger**: Depends on the successful completion of the `Create Release` workflow.
-   **Steps**:
    1.  **Checkout Code**: Fetches the repository code.
    2.  **Download Debian Package**: Downloads the `.deb` artifact generated by the `Create Release` workflow.
    3.  **Configure GPG**: Sets up GPG keys for signing the APT repository.
    4.  **Publish to APT**: Uses a custom action to add the `.deb` package to the APT repository and update the repository metadata.
    5.  **Deploy to GitHub Pages**: Pushes the updated APT repository to the `gh-pages` branch, making it accessible via GitHub Pages.

### Installing from the APT Repository

To install the application from the APT repository hosted on GitHub Pages, follow these steps:

1.  **Add the repository to your APT sources:**
    ```bash
    echo "deb [arch=amd64 signed-by=/usr/share/keyrings/ashnotes-app-archive-keyring.gpg] https://AABelkhiria.github.io/ashnotes-app/ stable main" | sudo tee /etc/apt/sources.list.d/ashnotes-app.list
    ```

2.  **Download and import the GPG public key:**
    ```bash
    wget -qO- https://AABelkhiria.github.io/ashnotes-app/public.key | gpg --dearmor | sudo tee /usr/share/keyrings/ashnotes-app-archive-keyring.gpg > /dev/null
    ```

3.  **Update your APT package list:**
    ```bash
    sudo apt update
    ```

After these steps, you can install the package using:
```bash
sudo apt install ashnotes-app
```


